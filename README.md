# FW Sense Hat

Simple Python module that read data from [Sense Hat](https://www.waveshare.com/sense-hat-c.htm)
and share them on the local DBus.<br />
This repository is part of the [Smart Van Project](https://smartvan.johnosproject.org/).

**FW Name:** FW Sense Hat<br />
**FW Group:** com.robypomper.smartvan.fw.sensehat<br />
**FW Version:** 1.0.0

[README](README.md) | [CHANGELOG](CHANGELOG.md) | [TODOs](TODOs.md) | [LICENCE](LICENCE.md)

Once ran, this script **reads data from the Sense Hat via I2C then notify
the DBus with updated values**. The DBus service and his properties are defined
into [_dbus_descs.py](fw_ioexp/ioexp/_dbus_descs.py) file. More info on
[Supported devices and value mapping](#supported-devices-and-value-mapping).


## Run

This is a Python script, so `python` is required to run it.

```shell
$ python --version
# if not installed, then run
$ sudo apt-get install python3 
```

In addition, some other package must be installed in order to configure
python's dependencies like `PyGObject` or `pydbus`. If you are using a
debian/ubuntu based distribution, then you can run:

```shell
$ sudo apt-get install libgirepository1.0-dev dbus-x11 libcairo2-dev 
```

Once Python was installed on your machine, you can install the script's
requirements globally or create a dedicated `venv`.

```shell
# Init venv (Optional)
$ python -m venv venev
$ source venv/bin/activate

# Install script's requirements
$ pip install -r requirements.txt
```

Now, you are ready to run the script with the command:

```shell
$ python run.py

or alternative options
$ python run.py --quiet
$ python run.py --debug --simulate
$ python run.py  --dbus-name com.custom.bus --dbus-obj-path /custom/path --dbus-iface com.custom.IFace
```

For script's [remote usage](remote_usage.md) please see the dedicated page.

Defaults DBus params are:
* DBus Name: `com.sensehat`
* DBus Obj Path: DEV_TYPE_* (eg: `/sense_hat_c`)
* DBus Interface: DEV_IFACE_* (eg: `com.sense`)

### Script's arguments

The `run.py` script accept following arguments:
 
* `-h`, `--help`: show this help message and exit
* `-v`, `--version`: show version and exit
* `--simulate`: Simulate a version `V3.2P`
* `--dbus-name DBUS_NAME`: DBus name
* `--dbus-obj-path DBUS_OBJ_PATH`: DBus object path (if None, the device type will be used, if empty nothing will be used)
* `--dbus-iface DBUS_IFACE`: DBus interface (if None, the device interface will be used, if empty nothing will be used)
* `--dev`: enable development mode, increase logged messages info
* `--debug`: Set log level to debug
* `--quiet`: Set log level to error


## Develop

The main goal for this script is to link the Device's protocol to the DBus.
So, in addition to the main script, all other files are related to the Device
or to the DBus protocols.


## Supported devices and value mapping

This script should be able to handle Sense Hat device that is connected to
the RaspberryPi via I2C communication.

On Sense Hat side, this script can read and handle all properties generated by the
device. The full list of implemented properties, but also the known versions
list can be found into the [`mappings.py`](fw_ioexp/ioexp/mappings.py) file.
More info about the Sense Hat (c) device can be found on the [module's wiki page](https://www.waveshare.com/wiki/Sense_HAT_(C)).

On the DBus side, is defined the "sense" iface.
When this script **is NOT connected to the Sense Hat or a chip is not available,
then it skipp it and continue**.
